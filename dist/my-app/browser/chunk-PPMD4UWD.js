import{d as l,j as u}from"./chunk-Y5MJWXHJ.js";import{I as s,M as a,R as n,g as o}from"./chunk-GBA5LKQX.js";var g="/api",i="jwt_token",m=class r{constructor(e,t){this.router=e;this.http=t}loggedIn=new o(this.hasToken());username=new o(this.getUsernameFromToken());roles=new o(this.getRolesFromToken());isLoggedIn$=this.loggedIn.asObservable();username$=this.username.asObservable();register(e){return this.http.post(`${g}/signup`,e)}login(e){return this.http.post(`${g}/login`,e).pipe(s(t=>{localStorage.setItem(i,t.token),this.loggedIn.next(!0),this.username.next(this.getUsernameFromToken()),this.roles.next(this.getRolesFromToken())}))}logout(){localStorage.removeItem(i),this.loggedIn.next(!1),this.username.next(null),this.roles.next([]),this.router.navigate(["/login"])}getToken(){return localStorage.getItem(i)}isLoggedIn(){return this.loggedIn.getValue()}getUsernameValue(){return this.username.getValue()}hasRole(e){return this.roles.getValue().includes(e)}hasToken(){return!!this.getToken()}getDecodedToken(){let e=this.getToken();if(!e)return null;try{return JSON.parse(atob(e.split(".")[1]))}catch{return null}}getUsernameFromToken(){let e=this.getDecodedToken();return e?e.sub:null}getRolesFromToken(){let e=this.getDecodedToken();if(e&&e.auth){if(typeof e.auth=="string")return[e.auth];if(Array.isArray(e.auth))return e.auth}return[]}static \u0275fac=function(t){return new(t||r)(n(u),n(l))};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})};export{m as a};
